= Wiren Board 7

**https://wirenboard.com/product/wiren-board-7/[Купить в интернет-магазине]**
image::WB7.2_side.png[title="Контроллер Wiren Board rev. 7.2"]
image::WB7.2_System_Level.png[title="Логическая блок-схема контроллера"]
image::SVG-Dashboard_Example.png[title="Пример https://wirenboard.com/wiki/SVG-Dashboards[графического SVG-дашборда]"]

**Эта статья описывает контроллер Wiren Board 7.
Описание следующей версии https://wirenboard.com/wiki/Wiren_Board_7.4[Wiren Board 7.4], а предыдущей — https://wirenboard.com/wiki/Wiren_Board_6[Wiren Board 6].**

== Сводная таблица характеристик

[cols="1,1"]
|===
|*Общее*
|*Общее*

|Процессор
|ARM Cortex A7 4 ядра 1.2 ГГц

|Память оперативная
|DDR3 RAM 1 Гбайт, 2 Гбайт или 512 Мбайт

|Память энергонезависимая
|eMMC 8 Гбайт MLC или 64 Гбайт TLC BiCS5
|=== 

////
{|  border="1" class="wikitable" style="text-align:left"

{{Wbincludes:Dimensions 6U }}
{{Wbincludes:Weight}} 235 г
|-
! colspan="2" |Условия эксплуатации
|-
|Температура воздуха
| Рабочий диапазон температур зависит от исполнения, которое выбирается при заказе:
* Industrial: от -40 до +75 °С ([[Wiren Board: Operating temperature |подробности]])
* Commercial: от 0 до +75 °С
|-
|Относительная влажность
|До 92%, без конденсации влаги
|-
|Климатическое исполнение по ГОСТ 15150-69
|[[Climatic | O2.1*]]
|-
{{Wbincludes:Warranty}}
!colspan="2" | '''Интерфейсы''' 
|-
|| RS-485 || '''2'''
|-
|| CAN || '''1''' — мультиплексирован с одним из RS-485
|-
|| Слот Micro SD до 60 Мбайт/с <br>(25 Мбайт/с в ревизии 7.2.1)|| '''1'''
|-
|| [[#Каналы W1-W2 | Порты Wx]]: интерфейс 1-Wire/дискретный вход || '''2''' 
|-
|| [[#Универсальные входы/выходы A1-A3 и D1 | Порты Ax]]: дискретный/аналоговый вход и выход «открытый коллектор» || '''3'''
|-
|| [[#Универсальные входы/выходы A1-A3 и D1 | Порт D1]]: дискретный вход/выход «открытый коллектор»|| '''1'''
|-
!colspan="2" | '''Коммуникации''' 
|-
|| Ethernet 10/100 ||  '''2''' (первый из портов с [[Power over Ethernet|Passive PoE]])
|-
|| USB Host (USB-A) || '''1'''
|- 
|| Debug Network (USB-C) || USB-сетевая карта для быстрой настройки контроллера. Важно: когда порт подключён к компьютеру — USB 1 отключается
|- 
|| Wi-Fi 802.11n ||  '''1''' AP, client
|- 
|| Bluetooth 4.0 || '''1'''
|-
|| Сотовая связь || 4G(LTE) или без модема  — можно выбрать при заказе
|- 
|| SIM-карты || '''2''' x SIM, одновременно в сети одна
|-

!colspan="2" | '''Питание''' 
|-
|| Напряжение || 9 - 48 В постоянного тока
|-
|| Потребляемая мощность || средняя 3 Вт, до 8 Вт с модемом
|-
|| Схема питания || от входа с бо&#x301;льшим напряжением 
|-
|| Входы питания || '''2''' на клеммах, 
'''1''' [[Power over Ethernet|Passive PoE]] на первом порту Ethernet с напряжением до 48 В постоянного тока. Важно: напряжение с PoE подаётся напрямую на выходы Vout — проверьте, что подключенные к нему устройства рассчитаны на это напряжение.
|-

!colspan="2" | '''Выходы для питания внешних устройств''' 
|-
|| Vout || На клеммы подаётся напряжение питания контроллера, но с ограничением тока, программным отключением и сохранением состояния при перезагрузке контроллера.
|-
|| 5Vout || 5 В — с ограничением тока и программным отключением
|-

!colspan="2" | '''Модульность''' 
|-
|| Слоты для внутренних модулей расширения || '''3''' с клеммами, '''1''' без клемм
|-
|| Другие разъемы || Для внешних модулей ввода-вывода WBIO, для модуля резервного питания
|-
{{Wbincludes:Software}}
!colspan="2" | '''Поддерживаемые протоколы, устройства и системы верхнего уровня''' 
|-
{{Wbincludes:Supported Devices Protocols}}
|| Устройства сторонних производителей || [[Supported devices#testing|Таблица поддерживаемых устройств]]
|}

== Первое включение ==
{{YouTube
|link=https://youtu.be/iUCNLI0yU94
|text= Знакомство с контроллером Wiren Board 7
}}
=== Сборка и запуск ===
Контроллер поставляется собранным, прошитым и готовым к работе, но перед его использованием надо выполнить несколько шагов:
# Прикрутите антенну Wi-Fi к разъёму SMA.
# Если установлен 4-G модем [[WBC-4G_v.2|WBC-4G v.2]] — прикрутите его антенну и [[SIM_card_installation|установите SIM-карту]].
# Подключите питание контроллера к клеммнику 9-48V или к интерфейсу Ethernet 1, если вы используете Passive PoE. Варианты подключения и схему смотрите в разделе [[#Питание|Питание]].
# Переведите переключатель на лицевой панели корпуса в положение ON, подождите пару минут, пока загружается ОС Linux. В рабочем режиме индикатор контроллера будет мигать зелёным с частотой один раз в секунду.

С контроллером можно взаимодействовать через встроенный веб-интерфейс или через командную строку. В обоих случаях вам нужно подключить контроллер к компьютеру и узнать его IP-адрес.

=== Подключение к компьютеру ===
В контроллере есть несколько интерфейсов для связи с компьютером: Debug Network, Wi-Fi, Ethernet и Debug Console.

Для первоначальной настройки удобно использовать Debug Network, в повседневной эксплуатации Wi-Fi или Ethernet, а в экстренных случаях [[WB_Debug_Console| Debug Console]], которая предоставляет доступ к логам загрузчика и командной строке.

Ниже мы рассмотрим основные моменты, полную информацию по настройке сети читайте в статье [[Networks| Настройка сети в контроллере Wiren Board]].

==== Debug Network ====
{{Wbincludes:Debug Network Connection}} 

Как пользоваться:
# Если у вас контроллер ревизии Wiren Board 7.2.1 — подключите внешнее питание, для остальных это не обязательно.
# Переведите выключатель на передней панели в положение ON.
{{Wbincludes:Debug Network Connection How To}}

Debug Network — это универсальный разъём и кроме доступа к консоли и веб-интерфейсу, с его помощью можно обновлять прошивку контроллера или удалять данные с откатом к заводской версии ПО — [[Debug_Network |подробнее]].

<gallery mode="packed" heights="150px">
Image: Wb7-debug-network.png | Разъём
Image: Wiren Board 7 Debug Network Virtual Lan.png | Веб-интерфейс контроллера и виртуальный накопитель с инструкцией
</gallery>

==== Wi-Fi ====
{{Wbincludes:Wi-Fi Connection}}

==== Ethernet ====
{{Wbincludes:Ethernet Connection}}

=== Веб-интерфейс ===
{{YouTube
|link=https://youtu.be/3QHtXODfuDY
|text= Веб-интерфейс контроллера Wiren Board 7
}}
В контроллере предустановлен веб-интерфейс, где вы можете настраивать контролер и подключённые к нему устройства, а также писать сценарии автоматизации, настраивать уведомления и создавать интерфейс оператора с помощью графических и текстовых панелей.

Читайте подробнее о веб-интерфейсе в [[Веб-интерфейс_Wiren_Board | документации]] и статье [https://wirenboard.com/ru/pages/wb-software/ Веб-интерфейс контроллеров Wiren Board].

=== Командная строка ===
{{YouTube
|link=https://youtu.be/VA_XHrY1RVA
|text= Про командную строку, SSH и Debug Console}}
Контроллер Wiren Board управляется ОС Linux, поэтому все настройки хранятся в файлах. Б''о''льшая часть настроек делается из веб-интерфейса контроллера, но иногда без командной строки не обойтись, например, если надо установить дополнительные программы, или настроить часовой пояс. 

Для доступа к командной строке подключитесь к контроллеру по протоколу [[SSH]] или через [[WB_Debug_Console| отладочный порт]].

=== Что дальше ===

[[Wiren_Board_Firmware_Update#web-ui|Обновите прошивку контроллера]], чтобы иметь самую свежую версию — проще всего это сделать через веб-интерфейс.

После того, как вы немного познакомились с контроллером, нужно подумать о безопасности:
# Сменить пароль пользователя root по [[SSH#Логин и пароль| инструкции]].
# Установить пароль на Wi-Fi — [[Networks | инструкция по настройке сети]].
# При использовании контроллера на предприятии надо [[Защита_паролем | защитить веб-интерфейс паролем]].
# Если планируете открывать доступ к контроллеру из интернета, то делайте это через [[Wirenboard6:InstallingOnTheRemoteSite#VPN | VPN]] или [[Tailscale]]. Никогда не назначайте контроллеру белый IP-адрес, вас могут [https://support.wirenboard.com/t/ogranichenie-dostupa/10644 взломать].

Дополнительно:
* Установите верный [[Time |часовой пояс]].
* Для активных пользователей и проектов на стадии стройки и пусконаладки рекомендуем переключить ПО контроллера на [[Обновление_прошивки|Testing релиз]].
* Если вы забыли пароль для входа — можете [[WB6_root_password_recovery|сбросить пароль пользователя root]].
* Если возникли неполадки с контроллером, вы можете провести [[How_to_diagnose|диагностику]].
* Настройте автоматизацию с помощью правил на [[wb-rules]].

Если в процессе экспериментов что-то пошло не так, или вам надо откатить контроллер к заводским настройкам, можете [[Wiren_Board_7_Firmware_Update#factory-reset| удалить все данные и вернуть установленное на заводе ПО]].

== Индикация этапов загрузки ==
[[Файл:Leds WB6.7.jpg|200px|thumb|right|Индикатор контроллера]]

{{Wbincludes:Wiren Board 6 Indicator}}
{| class="wikitable" style=""
|-
! style="width: 20%" | Условия
!style="width: 15%" | Индикация
! style="width: 25%" | Этапы
! style="width: 45%" | Сообщения в Debug-UART
|-
|Включение контроллера
|<span style="color:#FF8C00">горит оранжевый</span>
|Загрузчик U-boot ждёт команду по debug-uart в течение 3 секунд.
|<syntaxhighlight lang="bash">Hit any key to stop autoboot:  3</syntaxhighlight>
|-
|5 секунд после включения и в USB-разъём '''вставлен носитель с файлом обновления'''.
|<span style="color:#FF8C00">мигает оранжевый</span>
|Загрузчик U-boot увидел файл обновления и 3 секунды ждёт подтверждения. Подробнее в статье [[Обновление прошивки]].
|<syntaxhighlight lang="bash">##############################
# Detected USB flash drive with update file
# Filename: wb6_update_FACTORYRESET.fit
# Press a FW key if you want to update firmware from this file
# or wait 3 seconds to boot normally.
##############################</syntaxhighlight>
|-
|5 секунд после включения и '''USB-разъёмы свободны'''.
|<span style="color:#FF0000">горит красный</span>
|Загрузчик U-boot применяет аппаратную конфигурацию контроллера.
|<syntaxhighlight lang="bash">Applying DT overlay ...</syntaxhighlight>
|-
|10 секунд после включения.
|<span style="color:#FF0000">мигает красный</span>
|Загрузка OC и внутренних сервисов.
|Множество записей, есть <syntaxhighlight lang="bash">Welcome to Debian GNU/Linux 9 (stretch)!</syntaxhighlight>
|-
|60-70 секунд после включения.
|<span style="color:#008000">мигает зеленый</span>
|ОС загрузилась, контроллер готов к работе.
|Приглашение для входа в систему <syntaxhighlight lang="bash">wirenboard-<Серийный номер> login: </syntaxhighlight>
|-
|}
== Программное обеспечение ==
{{Wbincludes:Wiren Board Software}}

== Внутренние и внешние модули == 
<gallery mode="packed" heights="200px">
Файл:WB-7+WD-14+R10A-8.png|Контроллер Wiren Board 7 с боковыми модулями
File:Connecting_Side_Modules.png|Подключение модуля ввода-вывода к контроллеру
File:OPENTHERM.png|Модуль расширения OpenTherm
</gallery>

{{Wbincludes:Controller Modularity}}

== Беспроводные интерфейсы == 

{{Wbincludes: Controller Wireless interfaces}}

[[GSM/GPRS |'''Модуль сотовой связи''']] — 4G (LTE) или NB-IoT устанавливается в контроллер модулем расширения. Требуется SIM-карта формата nanoSIM.

Модем позволяет отправлять и принимать SMS, подключаться к интернету. Работа с двумя SIM-картами в режиме мультиплексирования. SIM-карты расположены под крышкой контролера.

Антенны Wi-Fi, GSM и радиомодулей подключаются к разъемам SMA. При слабом сигнале рекомендуется использовать выносную антенну и располагать ее вдали от контроллера.

== Проводные интерфейсы == 

'''Два интерфейса Ethernet''' поддерживают скорость 10/100 Мбит/с. [[Networks| Инструкция по настройке]].

'''Интерфейс USB.''' Контроллер оборудован одним портом USB 2.0 (A/F), который работает в режиме USB Host и поддерживает загрузку прошивки контроллера. Управление питанием USB-устройств см. в [[Питание USB-портов|Питание USB-портов]].

{{Wbincludes:Controller Wired interfaces}}

'''Debug Network''' — USB-C разъём, через который можно получить доступ к веб-интерфейсу или консоли контроллера, а также обновить прошивку или удалить все данные со сбросом к заводским настройкам. [[Debug_Network|Подробное описание разъёма и его функций]].

== Слот MicroSD ==
[[Image: WB7 MicroSD Slot.jpg |250px|thumb|right| Слот MicroSD в контроллере Wiren Board 7 ]]
В контроллере есть высокоскоростной слот для карт памяти MicroSD, который расположен на левом торце корпуса и поддерживает чтение/запись на скорости до 60 Мбайт/с (25 Мбайт/с в ревизии 7.2.1). Карта памяти вставляется контактами вниз до лёгкого щелчка.

Карту MicroSD удобно использовать для хранения бэкапов, лог-файлов или как расширение основной памяти контроллера.

После установки карта памяти будет доступна в устройстве <code>/dev/mmcblk1</code>, первый раздел которого будет автоматически примонтирован в <code>/mnt/sdcard</code>.

== Универсальные входы/выходы A1-A3 и D1 == 

<gallery mode="traditional" widths ="350px" heights="200px">
Image: WB6.Ax.png | Схема входов/выходов A1-A3 контроллера Wiren Board 7
Image: WB7.D1.png | Схема входа/выхода D1 контроллера Wiren Board 7
</gallery>

{| class="wikitable" 
|+ Функции универсальных входов/выходов
|-
! rowspan="2" | Функция
! rowspan="2" style="width: 350px"| Описание
! colspan="2" | Параметр / адрес в MQTT
|-
! Ax
! D1
|-
| Выход «[[OpenCollector_connecting |открытый коллектор]]»
| Ключ с током 1 А и на напряжение 30 В, замыкающий выход на землю
| I/O → Ax_OUT<br />wb-gpio/Ax_OUT
| I/O → D1_OUT<br />wb-gpio/D1_OUT
|-
| [[DI |Дискретный вход]]
| Срабатывает при напряжении на клемме больше 3 В (логическая единица), меньше 1.5 В — логический ноль
| I/O →Ax_IN<br />wb-gpio/Ax_IN
| I/O →D1_IN<br />wb-gpio/D1_IN
|-
| [[ADC |Аналоговый вход]]
| Диапазон измерений: 
* 0–31 В ''с ревизии 7.3.3''
* 0–28 В ''до ревизии 7.3.2 включительно''
Погрешность: 200 мВ + 2%
| ADCs → Ax<br />wb-adc/Ax
| -
|}

Входное сопротивление каналов 30 кОм начиная с версии 7.2.1. У ранних версий входное сопротивление каналов 100 кОм.

Режимы дискретный и аналоговый вход работают одновременно. При работе канала в режиме входа переключатель Ax_OUT (D1_OUT) должен быть выключен.

Канал в режиме выхода управляется переключателем Ax_OUT (D1_OUT): выключатель включён — выход замкнут на GND.

Смотрите также:
* [[Using Wiren Board with pulsed output devices | Подключение устройств с импульсным выходом к входам Ax]].
* [[Supported_devices | Подключение периферийных устройств]].

== Каналы W1-W2 == 
[[Image: WirenBoard+1-Wire.png |250px|thumb|right| Подключение датчика [[1-Wire]] к каналу '''W1''' контроллера Wiren Board]]
{{Wbincludes:Controller W1-W2}}
=== Режим дискретного входа ===
В режиме дискретного входа срабатывание происходит '''при замыкании на землю''' (GND), в отличие от каналов A1-A3 и D1.

== Выход питания +5Vout == 
{{Wbincludes:Controller +5Vout}}

== Выход питания Vout == 
[[Image:Wb7 protection Vout.png|thumb|250px|Схема защиты выходов Vout]]
{{note|warn| На клеммы Vout подаётся напряжение питания контроллера, убедитесь, что подключенные к клеммам устройства рассчитаны на это напряжение!}}

В контроллере есть два выхода Vout на которые подаётся напряжение питания контроллера, но с ограничением тока до 1 А суммарно, программным отключением и '''сохранением''' состояния при '''перезагрузке''' или '''отключении переключателем''' контроллера.

При питании контроллера от аккумулятора на выход подается напряжение +11 В.

Выходы можно отключить программно, контрол в веб-интерфейсе: устройство '''Discrete I/O''' → контрол '''V_OUT'''.

Защита построена на полифьюзе 1А, который восстанавливается через некоторое время после отключения нагрузки.

== Терминаторы линий RS-485 == 
{{Wbincludes:Controller RS-485 terminators}}

== Клеммники == 
Часть клеммников может выполнять более одной функции.
<gallery mode="packed" heights="350px">
Image: WB7 Terminal blocks.png | Порты и интерфейсы Wiren Board 7.2
Image: WB7 Inputs.png | Схема защиты входов и выходов
</gallery>

{|  border="1" width="700" class="wikitable" style="text-align:center"
!Подпись !! Max. V, I !! Доп. защита !! Состояние по умолчанию !!'''Функции'''
|-
| '''Vin'''  
|
52V
| От переполюсовки || ||Входное напряжение
|-
| '''GND''' || || || ||«Земля», минус блока питания. Все GND общие.
|-
| '''O1-O3''' || || || || |Входы/выходы модулей расширения
|-

|-
| '''A1-A3''' || 30 В, 1 А || От превышения тока, импульсных перенапряжений ||  High Z || [[Управление низковольтной нагрузкой|Выходы «открытый коллектор»]]<br>[[DI | Дискретные входы]], [[ADC|ADC]]
|-
| '''D1''' || 30 В, 1 А || От превышения тока, импульсных перенапряжений ||  High Z || [[Управление низковольтной нагрузкой|Выход «открытый коллектор»]]<br>[[DI | Дискретный вход]]
|-
| '''GND''' || || || || Для удобства подключения внешних датчиков
|-
| '''W1-W2''' || 40 В || || 5 В || [[1-Wire|1-Wire]], GPIO 
|-
| '''5V out''' || 5 В, 0.5 А || От превышения тока || 5 В || Выход 5 В. Программное включение-выключение
|-
| '''A''' ||  40 В || || 0 В || rowspan="2"|Порт [[RS-485|RS-485]]  (/dev/RS-485-1) 
|-
| '''B''' ||  40 В || || +5 В 
|-
|-
| '''L''' || 40 В || || 0 В ||  rowspan="2"|Порт CAN или [[RS-485|RS-485]]  (/dev/RS-485-2).
Подключение RS-485: A - к клемме '''A|L''', B - к клемме '''B|H'''.
|-
| '''H''' ||  40 В || || +5 В
|-
| '''Vout*''' || 1 А || От превышения тока, импульсных перенапряжений  ||  || Выход питания. Входное напряжение, программное отключение 
|-
|}
==Монтаж==
Контроллер монтируется на стандартную DIN-рейку шириной 35 мм и занимает пространство в 6 DIN-юнитов.
{| border="1" class="wikitable" style="text-align:left" 
{{Wbincludes:Klemmy}}
|Тип клемм || Винтовые, разъемные, шаг 3.5 мм
|}

{{Wbincludes:Mount Wires}}

== Другие интерфейсы == 
{{Wbincludes:Controller Other interfaces}}

== Сторожевой таймер ==

{{Wbincludes:Controller Watchdog}}

== Питание ==

{{Wbincludes:Controller Power}}

'''Для резервного питания''' можно подключить внутренний модуль [[WBMZ4-BATTERY_Backup_Power_Module | WBMZ4-BATTERY]] с Li-Pol аккумулятором или [[WBMZ4-SUPERCAP_Backup_Power_Module | WBMZ4-SUPERCAP]] с ионисторами.
При снижении напряжения Vin ниже 11 В, контроллер и модули, подключённые к выходу Vout питаются от 11 В, которые выдаёт модуль резервного питания. [[Backup_power_for_Wiren_Board_devices | Другие способы резервного питания]].

С ревизии 7.3 контроллер может питаться от портов USB-C, это удобно для сброса или настройки. Питание от этих портов маломощное, поэтому отключите от контроллера все устройства и боковые модули WBIO.

<gallery mode="traditional" widths ="350px" heights="333px">
Image: Power WB7.2.png | Блок-схема питания Wiren Board 7.2/7.3
Image: WB7.2 + HDR.png | Питание контроллера Wiren Board 7.2
</gallery>

== Поддерживаемые устройства == 

[[Периферийные устройства с интерфейсом RS-485 серии WB-xxxx | Устройства нашего производства с интерфейсом RS-485]]

[[Supported devices|Таблица поддерживаемых устройств]]

[[Using Wiren Board with peripheral devices|Подключение периферийных устройств]]

== Примеры сетевых настроек контроллера на удалённом объекте == 
* [[Tailscale | Tailscale — удалённый доступ к контроллеру Wiren Board без своего VPN-сервера]]
* [[Wirenboard6:InstallingOnTheRemoteSite|Шпаргалка: сетевые настройки контроллера на удалённом объекте]]

== Настройка времени и часового пояса ==
[[Time|Настройка даты и времени]]

== Известные неисправности ==
[[WB_7:_Errata | Список известных неисправностей (Errata) Wiren Board 7]]

== Ревизии устройства ==
Номер партии (Batch №) указан на наклейке, на боковой поверхности корпуса, а также на печатной плате. Номер партии контроллера складывается из номеров партий базовой и процессорной плат.

[[WB7_hardware_revisions | Аппаратные ревизии контроллера]] — описание изменений в плате контроллера.

[[IMX6UL board revisions | Ревизии процессорных модулей]] — описание изменений в платах процессорных модулей.

==Прочее== 

[[Wiren Board 7.2: Peripherals]] — для низкоуровневой работы с GPIO и другой периферией контроллера из собственного ПО.

[[Работа с GPIO|Работа с GPIO]] — как работать с GPIO напрямую.

[[Обновление прошивки|Обновление прошивки и сброс к заводским настройкам]].

[[WB6_root_password_recovery| Восстановление пароля пользователя root]].

== Изображения и чертежи устройства == 
{{Wbincludes:CDR lib}}

'''SVG:''' [[File:Wiren_Board-7.2.svg.zip]]

'''Autocad 2013 DXF:''' [[File:Wiren_Board-7.2.dxf.zip]]

'''Autocad PDF:''' [[File:Wiren_Board-7.2.dxf.pdf]]

{{Wbincludes: AutoCAD_base}}

'''Блоки питания, автоматы, УЗО и т.п:''':  [[Media:MW-HDR-30-24.dxf.zip|MW-HDR-30-24.dxf.zip]], [[Media:MW-HDR-30-24.pdf|MW-HDR-30-24.pdf]], [[Media:Other-units.zip|Other-units.zip]]

<gallery mode="packed" heights="250px">
Image: PCB WB7.2.png | Wiren Board 7 без корпуса (rev. 7.2), радиатор снят
Image: PCB WB7.2 bottom.png | Wiren Board 7 без корпуса, обратная сторона (rev. 7.2)
Image: PCB WB7.2 + radiator.png | Wiren Board 7 без корпуса (rev. 7.3)
Image: DIN 6U.png | Габаритные размеры
</gallery>
////